#!/bin/bash
d=~/.ipfs/bmw/opensuse
addobj=$1 #QmZxqNMLtxgSWtombH5Ade8zspWoT7BxtFUMvxCyDmekpC
addname=$(cut -c12-19 /ipfs/$addobj/tumbleweed/repo/oss/media.1/products) #20190310
head=`cat $d/head`
newhead=$(ipfs object patch add-link $head history/$addname $addobj)
newhead=$(ipfs object patch add-link $newhead current $addobj)
#too slow:ipfs pin update $head $newhead
ipfs pin add --recursive=false $newhead
ipfs pin add --recursive=false $newhead/history
mv $d/head{,.$addname}
echo $newhead > $d/head
fusermount -u /ipns
#ipfs name publish /ipfs/$newhead
cd ~/code/cvs/dynaname && TXTRECORD="dnslink=/ipfs/$newhead" ./dynaname -4 -S vm2b.zq1.de. -H tumbleweedipfs.d.zq1.de 

